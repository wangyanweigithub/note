1. 想要理解索引原理必须清楚一种数据结构：平衡树（非二叉）也就是b tree 或者 b+ tree
也有数据库也使用哈希桶做索引的数据结构，但主流都是用平衡树作为数据表的默认索引。

2. 一个加了主键的表，并不能被称之为表。一个没加主键的表，它的数据无序放置在存储器上，一行一行的排列的很整齐，跟我们认知中的表很接近。如果给表加上了主键，那么表在磁盘上的存储结构就由整齐的排列的结构转变成了树状结构，也就是上面说的[平衡树]结构，换句话说，就是整个表就变成了一个索引。没错，再说一遍，这个表变成了一个索引，也就是所谓的聚集索引。这就是为什么一个表只能有一个主键，一个表只能有一个<font color=red>聚集索引</font>因为主键的作用就是把表的数据格式换成**索引（平衡树）**的格式放置。

![pic1](https://images2015.cnblogs.com/blog/303980/201703/303980-20170331183916477-93039637.jpg)

![pic2](https://images2015.cnblogs.com/blog/303980/201703/303980-20170331183927805-434571358.jpg)

![pic3](https://images2015.cnblogs.com/blog/303980/201703/303980-20170331183940836-1426600354.png)

3. 假设一个树有10层，那么只需要10次IO能力和CPU的运算力就可以查找到数据。O(logn)，n是分叉树，结果就是层数。

4. 索引能让数据查询数据上升，而使得写入数据的的速度下降，因为平衡树这个结构必须一致维持在一个正确的状态，增删改查都会改变平衡树各节点中的索引数据内容，破坏树结构，因此，在每次数据改变时，DBMS必须去重新梳理树(索引)的结构以确保它的正确，这会带来不小的性能开销，也就是为什么索引会给查询以外的操作带来副作用的原因。

5. 聚簇索引
	> 聚簇索引也叫簇类索引，是一种对磁盘上实际数据重新组织以按指定的一个或多个列的值排序。由于聚簇索引的索引页面指针指向数据页面，所以使用聚簇索引查找数据几乎总是比使用非聚簇索引快。每张表只能建一个聚簇索引，并且建聚簇索引需要至少相当该表120%的附加空间，以存放该表的副本和索引中间页。

	1.  聚簇索引也称为聚集索引，聚类索引，簇集索引，聚簇索引确定表中数据的物理顺序。聚簇索引类似于电话簿，后者按姓氏排列数据。由于聚簇索引规定数据在表中的物理存储顺序，因此一个表只能包含一个聚簇索引。但该索引可以包含多个列（组合索引），就像电话簿按姓氏和名字进行组织一样。汉语字典也是聚簇索引的典型应用，在汉语字典里，索引项是字母+声调，字典正文也是按照先字母再声调的顺序排列。

	2. 聚簇索引对于那些经常要搜索范围值的列特别有效。使用聚簇索引找到包含第一个值的行后，便可以确保包含后续索引值的行在物理相邻。例如，如果应用程序执行的一个查询经常检索某一日期范围内的记录，则使用聚集索引可以迅速找到包含开始日期的行，然后检索表中所有相邻的行，直到到达结束日期。这样有助于提高此类查询的性能。同样，如果对从表中检索的数据进行排序时经常要用到某一列，则可以将该表在该列上聚簇（物理排序），避免每次查询该列时都进行排序，从而节省成本。

	3. 思想
	
		1. 大多数表都应该有聚簇索引或使用分区来降低对表尾页的竞争，在一个高事务的环境中，对最后一页的封锁严重影响系统的吞吐量。
		2. 在聚簇索引下，数据在物理上按顺序排在数据页上，重复值也排在一起，因而在那些包含范围检查(between、<、<=、>、>=)或使用group by或orderby的查询时，一旦找到具有范围中第一个键值的行，具有后续索引值的行保证物理上毗连在一起而不必进一步搜索，避免了大范围扫描，可以大大提高查询速度。
		3. 在一个频繁发生插入操作的表上建立聚簇索引时，不要建在具有单调上升值的列(如IDENTITY)上，否则会经常引起封锁冲突。
		4. 在聚簇索引中不要包含经常修改的列，因为码值修改后，数据行必须移动到新的位置。
		5. 选择聚簇索引应基于where子句和连接操作的类型。


#### 非聚集索引
1. 非聚集索引
	>非聚集索引和聚集索引一样， 同样是采用平衡树作为索引的数据结构。索引树结构中各节点的值来自于表中的索引字段， 假如给user表的name字段加上索引 ， 那么索引就是由name字段中的值构成，在数据改变时， DBMS需要一直维护索引结构的正确性。如果给表中多个字段加上索引 ， 那么就会出现多个独立的索引结构，每个索引（非聚集索引）互相之间不存在关联
	

![pic4](https://images2015.cnblogs.com/blog/303980/201703/303980-20170331184008805-68908020.jpg)

2. 每次给字段建一个新索引， 字段中的数据就会被复制一份出来， 用于生成索引。 因此， 给表添加索引，会增加表的体积， 占用磁盘存储空间。

3. <font color=red>非聚集索引和聚集索引的区别在于<font>， 通过聚集索引可以查到需要查找的数据， 而通过非聚集索引可以查到记录对应的主键值 ， 再使用主键的值通过聚集索引查找到需要的数据
![pic5](https://images2015.cnblogs.com/blog/303980/201703/303980-20170331184024758-1937607304.jpg)

4. 不管以任何方式查询表， 最终都会利用主键通过聚集索引来定位到数据， 聚集索引（主键）是通往真实数据所在的唯一路径。

5. 然而， 有一种例外可以不使用聚集索引就能查询出所需要的数据， 这种非主流的方法 称之为「覆盖索引」查询， 也就是平时所说的复合索引或者多字段索引查询。
